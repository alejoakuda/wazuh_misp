<!--
  Reglas personalizadas para correlación Wazuh + MISP
  Autor: Alejandro Fernandes aka Vernizus
  Propósito: Detectar coincidencias de hashes enviadas por integración MISP.
-->

<group name="misp,malware,threat_intel">

  <rule id="100800" level="0">
    <decoded_as>json</decoded_as>
    <field name="integration">misp</field>
    <description>MISP: Script de integracion ejecutado.</description>
  </rule>

  <rule id="100802" level="12">
    <if_sid>100800</if_sid>
    <field name="misp.found">1</field>
    <description>MISP: ¡Amenaza Detectada! Evento: $(misp.info) | Hash: $(misp.value)</description>
    
    <info type="link">$(misp.permalink)</info>
    
    <mitre>
      <id>T1566</id> <id>T1204.002</id> </mitre>
    <group>misp_match,threat_intel,malware_detection,pci_dss_10.6.1,gdpr_IV_35.7.d</group>
  </rule>

  <rule id="100803" level="3">
    <if_sid>100800</if_sid>
    <field name="misp.found">0</field>
    <description>MISP: Hash analizado y limpio: $(misp.error)</description>
    <group>misp_no_match</group>
  </rule>

  <rule id="100804" level="5">
    <if_sid>100800</if_sid>
    <field name="misp.error">Error API</field>
    <description>MISP: Error en la comunicación con el servidor MISP.</description>
    <group>misp_error</group>
  </rule>

</group>
